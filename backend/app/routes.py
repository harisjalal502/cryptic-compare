from flask import Blueprint, jsonify, request
from .services.binance import fetch_binance_data
from .services.coinbase import fetch_coinbase_data
from .services.kraken import fetch_kraken_data

bp = Blueprint('routes', __name__)

@bp.route('/crypto', methods=['GET'])
def get_crypto_data():
    exchange = request.args.get('exchange')
    crypto_a = request.args.get('crypto_a', 'BTC')
    crypto_b = request.args.get('crypto_b', 'USDT')

    if not exchange:
        return jsonify({'error': 'Exchange name is required'}), 400

    try:
        symbol = f"{crypto_a}/{crypto_b}"
        if exchange.lower() == 'binance':
            data = fetch_binance_data(symbol)
        elif exchange.lower() == 'coinbase':
            symbol = f"{crypto_a}/{crypto_b}".replace('USDT', 'USD')
            data = fetch_coinbase_data(symbol)
        elif exchange.lower() == 'kraken':
            data = fetch_kraken_data(symbol)
        else:
            return jsonify({'error': 'Unsupported exchange'}), 400

        return jsonify(data), 200
    except Exception as e:
        return jsonify({'error': str(e)}), 500


































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































